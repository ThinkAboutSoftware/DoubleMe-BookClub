## 27장 '크고 작은 모든' 서비스들

서비스 지향 아키텍처와 마이크로서비스 아키텍처가 인기를 끌고 있는 이유

- 서비스를 사용하면 상호 결합이 철저하게 분리되는 것처럼 보인다. 일부만 맞는 말이다.
- 서비스를 사용하면 개발과 배포 독립성을 지원하는 것처럼 보인다. 일부만 맞는 말이다.

### 서비스 아키텍처?

단순히 애플리케이션의 행위를 분리할 뿐인 서비스라면 값비싼 함수 호출에 불과하고 아키텍처 관점에서 꼭 중요하다고 볼 수는 없다.
기능을 프로세스나 플랫폼에 독립적이 되게끔 서비스들을 생성하면 의존성 규칙 준수 여부와 상관없이 큰 도움이 될 때가 많다. 그러나 서비스 그 자체로는 아키텍처를 정의하지 않는다.
결국 서비스는 프로세스나 플랫폼 경계를 가로지르는 함수 호출에 지나지 않는다.

### 서비스의 이점?

현재 인기를 끄는 서비스 아키텍처라는 통설에 대해 이의를 제기한다.

#### 결합 분리의 오류

서비스는 다른 서비스의 변수에 직접 접근할 수 없다. 그리고 모든 서비스의 인터페이스는 반드시 잘 정의되어 있어야 한다.
어느 정도 일리는 있지만, 꼭 그런 건 아니다. 공유하는 데이터에 의해 혹은 네트워크 상의 공유 자원 때문에 결합될 가능성이 여전히 존재한다.

인터페이스가 잘 정의되어 있어야 한다는 이점에 대해서라면 사실이다. 하지만 함수의 경우에도 전혀 다르지 않다.
서비스 인터페이스가 함수 인터페이스보다 더 엄밀하거나, 엄격하거나, 더 잘 정의되는 것은 아니다.
이러한 이점은 환성에 불과하다.

#### 개발 및 배포 독립성의 오류

DevOps 전담팀이 각 서비스를 유지보수하고 운영하는 책임을 질 수 있다. 이런 개발 및 배포 독립성은 확장 가능한scalable 것으로 간주된다.

이런 믿음은 어느 정도 일리가 있지만, 극히 일부일 뿐이다.

- 대규모 엔터프라이즈 시스템은 서비스 기반 시스템 이외에도, 모노리틱 시스템이나 컴포넌트 기반 시스템으로도 구축 가능하다.
- 서비스라고 해서 독립적으로 개발, 배포, 운영할 수 있는 건 아니다. 데이터나 행위에서 어느 정도 결합되어 있다면 결합된 정도에 맞게 개발, 배포, 운영을 조정해야만 한다.

### 야옹이 문제

택시 통합 시스템의 예.
확장 가능한 시스템을 위해 수많은 마이크로서비스를 기반으로 구축하기로 함.
TaxiUI 서비스는 고객을 담당 모바일 기기를 통해 택시를 호출한다.
TaxiFinder 서비스는 여러 TaxiSupplier의 현황을 검토해서 적합한 택시 후보를 선별한다.
TaxiSelector 서비스는 사용자가 지정한 비용, 시간, 고급 여부 등의 조건을 통해 후보 중에 적합한 택시를 선택한다.

어느날 마케팅 부서에서 야옹이를 배달하는 서비스를 제공하겠다는 계획을 발표한다.
이 기능을 구현하려면 서비스 전부를 변경해야 한다. 의심의 여지 없이 야옹이 배달 기능을 추가하려면 개발과 배포 전략을 매우 신중하게 조정해야 한다.

이 서비스들은 모두 결합되어 있어서 독립적으로 개발하고, 배포하거나, 유지될 수 없다.

이게 바로 횡단 관심사cross-cutting concern가 지는 문제다. 모든 소프트웨어 시스템은 서비스 지향이든 아니든 이 문제에 직면하게 마련이다.

### 객체가 구출하다

컴포넌트 기반 아키텍처에서는 이런 문제를 SOLID 설계 원칙을 통해 다형적으로 확장할 수 있는 클래스 집합을 생성해 새로운 기능을 처리하도록 함을 알 수 있다.

경계를 잘 나누고 의존성 규칙을 준수해서 kittens 컴포넌트는 디자인 패터인 템플릿 메서드나 전략 패턴 등을 이용해서 오버라이드 한다. 이 기능을 구현하는 클래스들은 UI의 제어 하에 팩토리가 생성한다.

이 전략을 따르더라도 야옹이 기능을 구현하려면 TaxiUI는 어쩔 수 없이 변경해야만 한다. 하지만 그 외의 것들은 변경할 필요가 없다. 새로 구현한 건 동적으로 런타임에 로드할 수 있게 만든다.

따라서 야옹이 기능은 결합이 분리되며, 독립적으로 개발하여 배포할 수 있다.

### 컴포넌트 기반 서비스

서비스는 SOLID 원칙대로 설계할 수 있으며 컴포넌트 구조를 갖출 수도 있다. 이를 통해 서비스 내의 기존 컴포넌트들을 변경하지 않고도 새로운 컴포넌트를 추가할 수 있다.

### 횡단 관심사

아키텍처 경계는 서비스 사이에 있지 않다. 오히려 서비스를 관통하며, 서비스를 컴포넌트 단위로 분할한다.
모든 주요 시스템들이 직면하는 횡단 관심사를 처리하려면 서비스 내부는 의존성 규칙을 준수하는 컴포넌트 아키텍처로 설계해야 한다. 이 서비스들은 시스템의 아키텍처 경계를 정의하지 않는다. 아키텍처 경계를 정의하는 것은 서비스 내에 위치한 컴포넌트다.  

### 결론

시스템의 아키텍처는 시스템 내부에 그어진 경계와 경계를 넘나드는 의존성에 의해 정의된다.
서비스는 단 하나의 아키텍처 경계로 둘러싸인 단일 컴포넌트로 만들 수 있다.
혹은 여러 아키텍처 경계로 분리된 다수의 컴포넌트로 구성할 수도 있다.